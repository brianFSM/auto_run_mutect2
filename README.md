# mutect2_script_builder
#### author: Brian Wray
#### 17-March-2021

### Description
Given a file with sample names inside, this program will parse the filenames for information regarding whether or not the sample is tumor or normal, and then generate a mutect2 script that will take into account how many normal and tumor samples there are.

This was started for project Abazeed-QDSC-480, where tumor samples have either "P1" or "P2" in the file name, and the normals have "PBL" in the filename

Here are some example file bases:
$ cat CCX205.txt
CCX205_P1_USE160357L-A37-A3_HJ7YMDSXX_L2
CCX205_P1_USE160357L-A37-A3_HJF23DSXX_L2
CCX205_PBL_USE160388L-A63-A3_HJKF3DSXX_L2
CCX205_PBL_USE160388L-A63-A3_HJMVHDSXX_L2

I can't imagine being able to make this script applicable to the many different ways that researchers name their samples, but I think that by having this general format, i.e. starting the filename with sample_sampleType, that it would be trivial to modify file names to reflect this format.

I'll be following the file structure I used for the Abazeed_QDSC-480
I have a file called filebases.txt generated by the RNASeqPipeline script, placed in data/reads. 
In addition I have a folder data/reads/samples that has a file for each of the sample names (e.g. the CCX205 in the examples above) that contains all of the filenameBases for that sample.

### Getting Started:
To do a test run:
$ bash run_main.sh

### Tools used:
- python3

### Example mutect2 commands [from here](https://gatk.broadinstitute.org/hc/en-us/articles/360056969692-Mutect2#--panel-of-normals):
- tumor with matched normal
gatk Mutect2 \
     -R reference.fa \
     -I tumor1.bam \
     -I tumor2.bam \
     -I normal1.bam \
     -I normal2.bam \
     -normal normal1_sample_name \
     -normal normal2_sample_name \
     --germline-resource af-only-gnomad.vcf.gz \
     --panel-of-normals pon.vcf.gz \
     -O somatic.vcf.gz

- tumor only:
gatk Mutect2 \
   -R reference.fa \
   -I sample.bam \
   -O single_sample.vcf.gz

#### Notes on "panel of normals"
* I tried generating a PoN but ran into issues with the CreateSomaticPanelOfNormals script so I just abandoned this part.


A panel of normals can be a useful (optional) input to help filter out commonly seen sequencing noise that may appear as low allele-fraction somatic variants.

[To create a panel of normals](https://gatk.broadinstitute.org/hc/en-us/articles/360047219031-CreateSomaticPanelOfNormals-BETA-):

Step 1. Run Mutect2 in tumor-only mode for each normal sample.

Note that as of May, 2019 -max-mnp-distance must be set to zero to avoid a bug in GenomicsDBImport.

 gatk Mutect2 -R reference.fasta -I normal1.bam -max-mnp-distance 0 -O normal1.vcf.gz

Step 2. Create a GenomicsDB from the normal Mutect2 calls.

gatk GenomicsDBImport -R reference.fasta -L intervals.interval_list \
       --genomicsdb-workspace-path pon_db \
       -V normal1.vcf.gz \
       -V normal2.vcf.gz \
       -V normal3.vcf.gz

Step 3. Combine the normal calls using CreateSomaticPanelOfNormals.

 gatk CreateSomaticPanelOfNormals -R reference.fasta -V gendb://pon_db -O pon.vcf.gz




